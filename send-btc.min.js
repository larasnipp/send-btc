var sendBTC={fiatRates:{USD:null,EUR:null,RUB:null,CNY:null,},refreshQRCodeDelay:400,fiatSymbol:function(a){return'<span class="fa fa-'+a.toLowerCase()+'"></span>'},refreshQRCode:function(b){delete this.refreshQRCodeID;var a=$("#send-btc-modal-qrcode");a.empty();a.qrcode(b)},refreshURI:function(c){var b="bitcoin:"+this.address+"?amount="+encodeURIComponent($("#send-btc-amount").val())+"&label="+encodeURIComponent($("#send-btc-label").val());$("#send-btc-uri").attr("href",b);$("#send-btc-modal-form").attr("action",b);if(this.refreshQRCodeID){clearTimeout(this.refreshQRCodeID)}if(c){var a=this;this.refreshQRCodeID=setTimeout(function(){a.refreshQRCode(b)},a.refreshQRCodeDelay)}else{delete this.refreshQRCodeID;this.refreshQRCode(b)}},refreshBTC:function(){var a=this.fiatRates[this.fiat];if(a){$("#send-btc-amount").val(($("#send-btc-fiat-amount").val()/a).toFixed(8));this.refreshURI(true)}},refreshFiat:function(){var a=this.fiatRates[this.fiat];if(a){$("#send-btc-fiat-amount").val(($("#send-btc-amount").val()*a).toFixed(8))}},setFiat:function(a){if(!(a in this.fiatRates)){throw'Invalid currency "'+a+'"'}this.fiat=a;$("#send-btc-modal-fiat-symbol").html(this.fiatSymbol(a));this.refreshFiat()},updateExchange:function(){var a=this;$.getJSON("https://blockchain.info/ticker",function(d,e){var b=$("#send-btc-modal-fiat-options");b.empty();var c=false;for(fiat in a.fiatRates){if(fiat in d){c=true;a.fiatRates[fiat]=d[fiat].last;b.append('<li style="cursor:pointer;"><a onclick="sendBTC.setFiat(\''+fiat+"');\">"+a.fiatSymbol(fiat)+" "+fiat+' <span class="text-muted">'+a.fiatRates[fiat]+"</span></a></li>")}}if(c){b.append('<li role="separator" class="divider"></li>')}b.append('<li style="cursor:pointer;"><a onclick="sendBTC.updateExchange();"><span class="text-muted">Fetch rates</span></a></li>');a.refreshFiat()})},insertModal:function(){$("#send-btc-modal").addClass("modal fade");$("#send-btc-modal").attr("tabindex","-1").attr("role","dialog").attr("aria-labelledby","send-btc-modal-title");$("#send-btc-modal").html('<div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button><h4 class="modal-title" id="send-btc-modal-title">Send to <a id="send-btc-uri"><span id="send-btc-address"></span></a></h4></div><form id="send-btc-modal-form" class="form-horizontal" role="form"><div class="modal-body"><div class="form-group"><label class="control-label col-sm-2" for="send-btc-label">Label</label> <span class="input-group col-sm-9"><input type="text" id="send-btc-label" class="form-control" name="label" placeholder="subject" oninput="sendBTC.refreshURI(true);"></span></div><div class="form-group"><label class="control-label col-sm-2" for="send-btc-amount">Amount</label> <span class="input-group col-sm-9"><input type="number" id="send-btc-amount" class="form-control" name="amount" min="0" step="1e-8" oninput="sendBTC.refreshFiat();sendBTC.refreshURI(true);" required=""> <span class="input-group-addon" aria-hidden="true"><span class="fa fa-btc"></span></span></span></div><div class="form-group"><label class="control-label col-sm-2 sr-only" for="send-btc-fiat-amount">Fiat amount</label> <span class="input-group col-sm-9"><input type="number" id="send-btc-fiat-amount" class="form-control" min="0" step="1e-8" oninput="sendBTC.refreshBTC();"> <span class="input-group-btn"><button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="fa fa-caret-down"></span> <span id="send-btc-modal-fiat-symbol"></span></button><ul id="send-btc-modal-fiat-options" class="dropdown-menu"><li style="cursor:pointer;"><a onclick="sendBTC.updateExchange();"><span class="text-muted">Fetch rates</span></a></li></ul></span></span></div><div id="send-btc-modal-qrcode" class="text-center"></div></div><div class="modal-footer"><input type="submit" class="btn btn-primary" value="Open in wallet"> <button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></form></div></div>')},init:function(){this.insertModal();sendBTC.updateExchange();$("#send-btc-modal").on("show.bs.modal",function(f){var d=$(f.relatedTarget);var b=d.data("address")||"";var c=d.data("label")||"";var e=d.data("amount")||"0.0";var a=d.data("fiat")||"USD";if(!$.isNumeric(e)||e<0){throw'Invalid amount "'+e+'"'}if(!(a in sendBTC.fiatRates)){throw'Invalid currency "'+a+'"'}sendBTC.address=b;sendBTC.label=c;$("#send-btc-address").text(b);$("#send-btc-label").val(c);$("#send-btc-amount").val(e);sendBTC.setFiat(a);sendBTC.refreshURI()})},};sendBTC.init();